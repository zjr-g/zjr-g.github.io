<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Aes加密解析 | ZJR&#39;blog</title>
  <meta name="keywords" content=" aes加密 ">
  <meta name="description" content="Aes加密解析 | ZJR&#39;blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="题目来自攻防世界 web2题目来源：NSCTF 对算法的逆向，主要是考查对php各个函数的理解和使用，挺简单的一道算法逆向 题目： &lt;?php $miwen&#x3D;&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;;  function encode($str){     $_o&#x3D;strrev($str)">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF-web-03">
<meta property="og:url" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/index.html">
<meta property="og:site_name" content="ZJR&#39;blog">
<meta property="og:description" content="题目来自攻防世界 web2题目来源：NSCTF 对算法的逆向，主要是考查对php各个函数的理解和使用，挺简单的一道算法逆向 题目： &lt;?php $miwen&#x3D;&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;;  function encode($str){     $_o&#x3D;strrev($str)">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/supersqli01.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/supersqli02.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/supersqli03.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/supersqli04.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/easytornado01.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/easytornado02.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/easytornado03.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/easytornado04.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/FlatScience01.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/FlatScience02.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/FlatScience03.png">
<meta property="og:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/FlatScience04.png">
<meta property="article:published_time" content="2020-03-03T14:52:30.000Z">
<meta property="article:modified_time" content="2020-03-03T14:53:26.531Z">
<meta property="article:author" content="ZJR">
<meta property="article:tag" content="ctf-web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://zjr-g.github.io/2020/03/03/CTF-web-03/supersqli01.png">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

<meta name="generator" content="Hexo 4.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>ZJR</span>
</div>

<div class="icon">
    
        
    
        
        <a title="github" href="https://github.com/zjr-g" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a title="email" href="mailto:zjre@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=1402576652&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
</div>




<ul>
    <li><div class="all active">全部文章</div></li>
    
        
            
            <li><div data-rel="Tips">Tips</div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="CTF">CTF</div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="MySqlCourse">MySqlCourse</div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="23">
<input type="hidden" id="yelog_site_word_count" value="34.5k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="Search..." />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color1">aes加密</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">base64</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">ctf-web</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">file_incloude</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Git</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">MySql_show</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">MySql_where</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">MySql_like</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MySql_select</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">MySql_order by</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MySql_regexp</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MySql_concat</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">MySql_function</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">MySql_group by</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MySql_having</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">MySql_subquery</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">MySql_jion</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">MySql_union</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MySql_insert</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MySql_update</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MySql_delete</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MySql_create</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">MySql_alter</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">SSIT</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">zip</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Markdown</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">hexo</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class="Tips "
           href="/2020/02/18/Aes/"
           data-tag="aes加密"
           data-author="" >
            <span class="post-title" title="Aes加密解析">Aes加密解析</span>
            <span class="post-date" title="2020-02-18 11:13:30">2020/02/18</span>
        </a>
        
        <a  class="CTF "
           href="/2020/02/11/Base64/"
           data-tag="base64"
           data-author="" >
            <span class="post-title" title="神奇的Base64隐写">神奇的Base64隐写</span>
            <span class="post-date" title="2020-02-11 21:01:02">2020/02/11</span>
        </a>
        
        <a  class="CTF "
           href="/2020/02/28/CTF-web-01/"
           data-tag="ctf-web"
           data-author="" >
            <span class="post-title" title="CTF-web-01">CTF-web-01</span>
            <span class="post-date" title="2020-02-28 20:11:44">2020/02/28</span>
        </a>
        
        <a  class="CTF "
           href="/2020/03/03/CTF-web-02/"
           data-tag="ctf-web"
           data-author="" >
            <span class="post-title" title="CTF-web-02">CTF-web-02</span>
            <span class="post-date" title="2020-03-03 22:48:14">2020/03/03</span>
        </a>
        
        <a  class="CTF "
           href="/2020/03/03/CTF-web-03/"
           data-tag="ctf-web"
           data-author="" >
            <span class="post-title" title="CTF-web-03">CTF-web-03</span>
            <span class="post-date" title="2020-03-03 22:52:30">2020/03/03</span>
        </a>
        
        <a  class="Tips "
           href="/2020/02/28/FileIncloude/"
           data-tag="file_incloude"
           data-author="" >
            <span class="post-title" title="FileIncloude(常见的文件包含漏洞及PHP伪协议分析)">FileIncloude(常见的文件包含漏洞及PHP伪协议分析)</span>
            <span class="post-date" title="2020-02-28 20:56:42">2020/02/28</span>
        </a>
        
        <a  class="Tips "
           href="/2020/02/18/Git/"
           data-tag="Git"
           data-author="" >
            <span class="post-title" title="Git">Git</span>
            <span class="post-date" title="2020-02-18 19:47:13">2020/02/18</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/01/31/MySql-Course01/"
           data-tag="MySql_show"
           data-author="" >
            <span class="post-title" title="MySql(连接，创建等操作)">MySql(连接，创建等操作)</span>
            <span class="post-date" title="2020-01-31 21:02:14">2020/01/31</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/02/MySql-Course03/"
           data-tag="MySql_where,MySql_like"
           data-author="" >
            <span class="post-title" title="MySql(数据过滤)">MySql(数据过滤)</span>
            <span class="post-date" title="2020-02-02 10:55:26">2020/02/02</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/01/MySql-Course02/"
           data-tag="MySql_select,MySql_order by"
           data-author="" >
            <span class="post-title" title="MySql(select的使用)">MySql(select的使用)</span>
            <span class="post-date" title="2020-02-01 11:12:32">2020/02/01</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/03/MySql-Course04/"
           data-tag="MySql_regexp"
           data-author="" >
            <span class="post-title" title="MySql(正则表达式)">MySql(正则表达式)</span>
            <span class="post-date" title="2020-02-03 11:22:09">2020/02/03</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/03/MySql-Course05/"
           data-tag="MySql_concat"
           data-author="" >
            <span class="post-title" title="MySql(字符拼接)">MySql(字符拼接)</span>
            <span class="post-date" title="2020-02-03 18:24:11">2020/02/03</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/04/MySql-Course06/"
           data-tag="MySql_function"
           data-author="" >
            <span class="post-title" title="MySql(函数)">MySql(函数)</span>
            <span class="post-date" title="2020-02-04 10:33:02">2020/02/04</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/05/MySql-Course07/"
           data-tag="MySql_group by,MySql_having"
           data-author="" >
            <span class="post-title" title="MySql(数据分组)">MySql(数据分组)</span>
            <span class="post-date" title="2020-02-05 09:49:48">2020/02/05</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/05/MySql-Course08/"
           data-tag="MySql_subquery"
           data-author="" >
            <span class="post-title" title="MySql(子查询)">MySql(子查询)</span>
            <span class="post-date" title="2020-02-05 11:04:05">2020/02/05</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/06/MySql-Course09/"
           data-tag="MySql_jion"
           data-author="" >
            <span class="post-title" title="MySql(联结)">MySql(联结)</span>
            <span class="post-date" title="2020-02-06 16:59:41">2020/02/06</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/07/MySql-Course10/"
           data-tag="MySql_union"
           data-author="" >
            <span class="post-title" title="MySql(组合查询UNION)">MySql(组合查询UNION)</span>
            <span class="post-date" title="2020-02-07 11:37:50">2020/02/07</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/07/MySql-Course11/"
           data-tag="MySql_insert,MySql_update,MySql_delete"
           data-author="" >
            <span class="post-title" title="MySql(增删改)">MySql(增删改)</span>
            <span class="post-date" title="2020-02-07 12:36:57">2020/02/07</span>
        </a>
        
        <a  class="MySqlCourse "
           href="/2020/02/08/MySql-Course12/"
           data-tag="MySql_create,MySql_alter"
           data-author="" >
            <span class="post-title" title="MySql(创建和操纵表)">MySql(创建和操纵表)</span>
            <span class="post-date" title="2020-02-08 10:54:47">2020/02/08</span>
        </a>
        
        <a  class="Tips "
           href="/2020/02/28/SSIT-Inject/"
           data-tag="SSIT"
           data-author="" >
            <span class="post-title" title="SSIT-Inject">SSIT-Inject</span>
            <span class="post-date" title="2020-02-28 20:52:27">2020/02/28</span>
        </a>
        
        <a  class="Tips "
           href="/2020/02/11/Zip/"
           data-tag="zip"
           data-author="" >
            <span class="post-title" title="Zip结构及其伪加密">Zip结构及其伪加密</span>
            <span class="post-date" title="2020-02-11 21:03:24">2020/02/11</span>
        </a>
        
        <a  class="Tips "
           href="/2020/01/23/StudyM/"
           data-tag="Markdown"
           data-author="" >
            <span class="post-title" title="LearnMarkdown">LearnMarkdown</span>
            <span class="post-date" title="2020-01-23 00:45:22">2020/01/23</span>
        </a>
        
        <a  class="Tips "
           href="/2020/01/24/hexo-tips-01/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="hexo中插入本地图片">hexo中插入本地图片</span>
            <span class="post-date" title="2020-01-24 10:13:53">2020/01/24</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-Aes" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Aes加密解析</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a  data-rel="Tips">Tips</a>
            
        </span>
        
        
        <span class="tag">
            
            <a class="color1">aes加密</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2020-02-28 20:51:08'>2020-02-18 11:13</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:7k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#AES各个部分的作用与意义"><span class="toc-text">AES各个部分的作用与意义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AES的基本结构"><span class="toc-text">AES的基本结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字节代换"><span class="toc-text">字节代换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#字节代换操作"><span class="toc-text">字节代换操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字节代换逆操作"><span class="toc-text">字节代换逆操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#行移位"><span class="toc-text">行移位</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#行移位操作"><span class="toc-text">行移位操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#行移位的逆变换"><span class="toc-text">行移位的逆变换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#列混合"><span class="toc-text">列混合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#列混合操作"><span class="toc-text">列混合操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#列混合逆运算"><span class="toc-text">列混合逆运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#轮密钥加"><span class="toc-text">轮密钥加</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#密钥扩展"><span class="toc-text">密钥扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AES代码实现"><span class="toc-text">AES代码实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分组密码加密中的四种模式"><span class="toc-text">分组密码加密中的四种模式:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ECB模式"><span class="toc-text">ECB模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CBC模式"><span class="toc-text">CBC模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CFB模式"><span class="toc-text">CFB模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OFB模式"><span class="toc-text">OFB模式</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>高级加密标准(AES,Advanced Encryption Standard)为最常见的对称加密算法(微信小程序加密传输就是用这个加密算法的)。对称加密算法也就是加密和解密用相同的密钥，具体的加密流程如下图：</p>
<p><img src="aes01.png" alt="aes01"></p>
<h2 id="AES各个部分的作用与意义"><a href="#AES各个部分的作用与意义" class="headerlink" title="AES各个部分的作用与意义"></a>AES各个部分的作用与意义</h2><ul>
<li>明文P</li>
</ul>
<blockquote>
<p>没有经过加密的数据。</p>
</blockquote>
<ul>
<li>密钥K</li>
</ul>
<blockquote>
<p>用来加密明文的密码，在对称加密算法中，加密与解密的密钥是相同的。密钥为接收方与发送方协商产生，但不可以直接在网络上传输，否则会导致密钥泄漏，通常是通过非对称加密算法加密密钥，然后再通过网络传输给对方，或者直接面对面商量密钥。密钥是绝对不可以泄漏的，否则会被攻击者还原密文，窃取机密数据。</p>
</blockquote>
<ul>
<li>AES加密函数</li>
</ul>
<blockquote>
<p>设AES加密函数为E，则 C = E(K, P),其中P为明文，K为密钥，C为密文。也就是说，把明文P和密钥K作为加密函数的参数输入，则加密函数E会输出密文C。</p>
</blockquote>
<ul>
<li>密文C</li>
</ul>
<p>经加密函数处理后的数据</p>
<ul>
<li>AES解密函数</li>
</ul>
<p>设AES解密函数为D，则 P = D(K, C),其中C为密文，K为密钥，P为明文。也就是说，把密文C和密钥K作为解密函数的参数输入，则解密函数会输出明文P。</p>
<h2 id="AES的基本结构"><a href="#AES的基本结构" class="headerlink" title="AES的基本结构"></a>AES的基本结构</h2><p>AES为分组密码，分组密码也就是把明文分成一组一组的，每组长度相等，每次加密一组数据，直到加密完整个明文。在AES标准规范中，分组长度只能是128位，也就是说，每个分组为16个字节（每个字节8位）。密钥的长度可以使用128位、192位或256位。密钥的长度不同，推荐加密轮数也不同，如下表所示：</p>
<table>
<thead>
<tr>
<th align="left">AES</th>
<th align="left">密钥长度(32位比特字)</th>
<th align="left">分组长度(32位比特字)</th>
<th align="left">加密轮数</th>
</tr>
</thead>
<tbody><tr>
<td align="left">AES-128</td>
<td align="left">4</td>
<td align="left">4</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">AES-192</td>
<td align="left">6</td>
<td align="left">4</td>
<td align="left">12</td>
</tr>
<tr>
<td align="left">AES-256</td>
<td align="left">8</td>
<td align="left">4</td>
<td align="left">14</td>
</tr>
</tbody></table>
<p>轮数在下面介绍，这里实现的是AES-128，也就是密钥的长度为128位，加密轮数为10轮。<br>上面说到，AES的加密公式为C = E(K,P)，在加密函数E中，会执行一个轮函数，并且执行10次这个轮函数，这个轮函数的前9次执行的操作是一样的，只有第10次有所不同。也就是说，一个明文分组会被加密10轮。AES的核心就是实现一轮中的所有操作。</p>
<p>AES的处理单位是字节，128位的输入明文分组P和输入密钥K都被分成16个字节，分别记为P = P0 P1 … P15 和 K = K0 K1 … K15。如，明文分组为P = abcdefghijklmnop,其中的字符a对应P0，p对应P15。一般地，明文分组用字节为单位的正方形矩阵描述，称为状态矩阵。在算法的每一轮中，状态矩阵的内容不断发生变化，最后的结果作为密文输出。该矩阵中字节的排列顺序为从上到下、从左至右依次排列，如下图所示：<br><img src="aes02.png" alt="aes02"></p>
<p>现在假设明文分组P为”abcdefghijklmnop”，则对应上面生成的状态矩阵图如下：<br><img src="aes03.png" alt="aes03"><br>上图中，0x61为字符a的十六进制表示。可以看到，明文经过AES加密后，已经面目全非。</p>
<p>类似地，128位密钥也是用字节为单位的矩阵表示，矩阵的每一列被称为1个32位比特字。通过密钥编排函数该密钥矩阵被扩展成一个44个字组成的序列W[0],W[1], … ,W[43],该序列的前4个元素W[0],W[1],W[2],W[3]是原始密钥，用于加密运算中的初始密钥加（下面介绍）;后面40个字分为10组，每组4个字（32比特）分别用于10轮加密运算中的轮密钥加，如下图所示：<br><img src="aes04.jpg" alt="aes04"><br>上图中，设K = “abcdefghijklmnop”，则K0 = a, K15 = p, W[0] = K0 K1 K2 K3 = “abcd”。</p>
<p>AES的整体结构如下图所示，其中的W[0,3]是指W[0]、W[1]、W[2]和W[3]串联组成的128位密钥。加密的第1轮到第9轮的轮函数一样，包括4个操作：字节代换、行位移、列混合和轮密钥加。最后一轮迭代不执行列混合。另外，在第一轮迭代之前，先将明文和原始密钥进行一次异或加密操作。<br><img src="aes05.jpg" alt="aes05"><br>上图也展示了AES解密过程，解密过程仍为10轮，每一轮的操作是加密操作的逆操作。由于AES的4个轮操作都是可逆的，因此，解密操作的一轮就是顺序执行逆行移位、逆字节代换、轮密钥加和逆列混合。同加密操作类似，最后一轮不执行逆列混合，在第1轮解密之前，要执行1次密钥加操作。</p>
<p>下面分别介绍AES中一轮的4个操作阶段，这4分操作阶段使输入位得到充分的混淆。</p>
<h2 id="字节代换"><a href="#字节代换" class="headerlink" title="字节代换"></a>字节代换</h2><h3 id="字节代换操作"><a href="#字节代换操作" class="headerlink" title="字节代换操作"></a>字节代换操作</h3><p>AES的字节代换其实就是一个简单的查表操作。AES定义了一个S盒和一个逆S盒。<br>AES的S盒：<br><img src="aes06.png" alt="aes06"><br>状态矩阵中的元素按照下面的方式映射为一个新的字节：把该字节的高4位作为行值，低4位作为列值，取出S盒或者逆S盒中对应的行的元素作为输出。例如，加密时，输出的字节S1为0x12,则查S盒的第0x01行和0x02列，得到值0xc9,然后替换S1原有的0x12为0xc9。状态矩阵经字节代换后的图如下：<br><img src="aes07.png" alt="aes07"></p>
<h3 id="字节代换逆操作"><a href="#字节代换逆操作" class="headerlink" title="字节代换逆操作"></a>字节代换逆操作</h3><p>逆字节代换也就是查逆S盒来变换，逆S盒如下：<br><img src="aes08.png" alt="aes08"></p>
<h2 id="行移位"><a href="#行移位" class="headerlink" title="行移位"></a>行移位</h2><h3 id="行移位操作"><a href="#行移位操作" class="headerlink" title="行移位操作"></a>行移位操作</h3><p>行移位是一个简单的左循环移位操作。当密钥长度为128比特时，状态矩阵的第0行左移0字节，第1行左移1字节，第2行左移2字节，第3行左移3字节，如下图所示：<br><img src="aes09.jpg" alt="aes09"></p>
<h3 id="行移位的逆变换"><a href="#行移位的逆变换" class="headerlink" title="行移位的逆变换"></a>行移位的逆变换</h3><p>行移位的逆变换是将状态矩阵中的每一行执行相反的移位操作，例如AES-128中，状态矩阵的第0行右移0字节，第1行右移1字节，第2行右移2字节，第3行右移3字节</p>
<h2 id="列混合"><a href="#列混合" class="headerlink" title="列混合"></a>列混合</h2><h3 id="列混合操作"><a href="#列混合操作" class="headerlink" title="列混合操作"></a>列混合操作</h3><p>列混合变换是通过矩阵相乘来实现的，经行移位后的状态矩阵与固定的矩阵相乘，得到混淆后的状态矩阵，如下图的公式所示：<br><img src="aes10.png" alt="aes10"><br>状态矩阵中的第j列(0 ≤j≤3)的列混合可以表示为下图所示：<br><img src="aes11.png" alt="aes11"><br>其中，矩阵元素的乘法和加法都是定义在基于GF(2^8)上的二元运算,并不是通常意义上的乘法和加法。这里涉及到一些信息安全上的数学知识，不过不懂这些知识也行。其实这种二元运算的加法等价于两个字节的异或，乘法则复杂一点。对于一个8位的二进制数来说，使用域上的乘法乘以(00000010)等价于左移1位(低位补0)后，再根据情况同(00011011)进行异或运算，设S1 = (a7 a6 a5 a4 a3 a2 a1 a0)，刚0x02 * S1如下图所示：<br><img src="aes12.png" alt="aes12"><br>其中，矩阵元素的乘法和加法都是定义在基于GF(2^8)上的二元运算,并不是通常意义上的乘法和加法。这里涉及到一些信息安全上的数学知识，不过不懂这些知识也行。其实这种二元运算的加法等价于两个字节的异或，乘法则复杂一点。对于一个8位的二进制数来说，使用域上的乘法乘以(00000010)等价于左移1位(低位补0)后，再根据情况同(00011011)进行异或运算，设S1 = (a7 a6 a5 a4 a3 a2 a1 a0)，刚0x02 * S1如下图所示：<br><img src="aes14.png" alt="aes14"><br>也就是说，如果a7为1，则进行异或运算，否则不进行。<br>类似地，乘以(00000100)可以拆分成两次乘以(00000010)的运算：<br><img src="aes15.png" alt="aes15"><br>乘以(0000 0011)可以拆分成先分别乘以(0000 0001)和(0000 0010)，再将两个乘积异或：<br><img src="aes16.png" alt="aes16"><br>因此，我们只需要实现乘以2的函数，其他数值的乘法都可以通过组合来实现。<br>下面举个具体的例子,输入的状态矩阵如下：<br><img src="aes17.png" alt="aes17"><br>下面，进行列混合运算：<br>以第一列的运算为例：<br><img src="aes18.png" alt="aes18"><br>其它列的计算就不列举了，列混合后生成的新状态矩阵如下：<br><img src="aes19.png" alt="aes19"></p>
<h3 id="列混合逆运算"><a href="#列混合逆运算" class="headerlink" title="列混合逆运算"></a>列混合逆运算</h3><p>逆向列混合变换可由下图的矩阵乘法定义<br><img src="aes20.png" alt="aes20"></p>
<h2 id="轮密钥加"><a href="#轮密钥加" class="headerlink" title="轮密钥加"></a>轮密钥加</h2><p>轮密钥加是将128位轮密钥Ki同状态矩阵中的数据进行逐位异或操作，如下图所示。其中，密钥Ki中每个字W[4i],W[4i+1],W[4i+2],W[4i+3]为32位比特字，包含4个字节，他们的生成算法下面在下面介绍。轮密钥加过程可以看成是字逐位异或的结果，也可以看成字节级别或者位级别的操作。也就是说，可以看成S0 S1 S2 S3 组成的32位字与W[4i]的异或运算。<br><img src="aes21.jpg" alt="aes21"><br>轮密钥加的逆运算同正向的轮密钥加运算完全一致，这是因为异或的逆操作是其自身。轮密钥加非常简单，但却能够影响S数组中的每一位。</p>
<h2 id="密钥扩展"><a href="#密钥扩展" class="headerlink" title="密钥扩展"></a>密钥扩展</h2><p>AES首先将初始密钥输入到一个4*4的状态矩阵中，如下图所示。<br><img src="aes22.jpg" alt="aes22"><br>这个44矩阵的每一列的4个字节组成一个字，矩阵4列的4个字依次命名为W[0]、W[1]、W[2]和W[3]，它们构成一个以字为单位的数组W。例如，设密钥K为”abcdefghijklmnop”,则K0 = ‘a’,K1 = ‘b’, K2 = ‘c’,K3 = ‘d’,W[0] = “abcd”。<br>接着，对W数组扩充40个新列，构成总共44列的扩展密钥数组。新列以如下的递归方式产生：</p>
<ol>
<li>如果i不是4的倍数，那么第i列由如下等式确定：<br>W[i]=W[i-4]⨁W[i-1]</li>
<li>如果i是4的倍数，那么第i列由如下等式确定：<br>W[i]=W[i-4]⨁T(W[i-1])</li>
</ol>
<p>其中，T是一个有点复杂的函数。<br>函数T由3部分组成：字循环、字节代换和轮常量异或，这3部分的作用分别如下。<br>a. 字循环：将1个字中的4个字节循环左移1个字节。即将输入字[b0, b1, b2, b3]变换成[b1,b2,b3,b0]。<br>b. 字节代换：对字循环的结果使用S盒进行字节代换。<br>c. 轮常量异或：将前两步的结果同轮常量Rcon[j]进行异或，其中j表示轮数。<br>轮常量Rcon[j]是一个字，其值见下表。</p>
<table>
<thead>
<tr>
<th align="center">j</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Rcon[j]</td>
<td align="center">01 00 00 00</td>
<td align="center">02 00 00 00</td>
<td align="center">04 00 00 00</td>
<td align="center">08 00 00 00</td>
<td align="center">10 00 00 00</td>
</tr>
<tr>
<td align="center">j</td>
<td align="center">6</td>
<td align="center">7</td>
<td align="center">8</td>
<td align="center">9</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">Rcon[j]</td>
<td align="center">20 00 00 00</td>
<td align="center">40 00 00 00</td>
<td align="center">80 00 00 00</td>
<td align="center">1B 00 00 00</td>
<td align="center">36 00 00 00</td>
</tr>
</tbody></table>
<p>下面举个例子：<br>设初始的128位密钥为：<br>3C A1 0B 21 57 F0 19 16 90 2E 13 80 AC C1 07 BD<br>那么4个初始值为：<br>W[0] = 3C A1 0B 21<br>W[1] = 57 F0 19 16<br>W[2] = 90 2E 13 80<br>W[3] = AC C1 07 BD<br>下面求扩展的第1轮的子密钥(W[4],W[5],W[6],W[7])。<br>由于4是4的倍数，所以：<br>W[4] = W[0] ⨁ T(W[3])<br>T(W[3])的计算步骤如下：</p>
<ol>
<li>循环地将W[3]的元素移位：AC C1 07 BD变成C1 07 BD AC;</li>
<li>将 C1 07 BD AC 作为S盒的输入，输出为78 C5 7A 91;</li>
<li>将78 C5 7A 91与第一轮轮常量Rcon[1]进行异或运算，将得到79 C5 7A 91，因此，T(W[3])=79 C5 7A 91，故<br>W[4] = 3C A1 0B 21 ⨁ 79 C5 7A 91 = 45 64 71 B0<br>其余的3个子密钥段的计算如下：<br>W[5] = W[1] ⨁ W[4] = 57 F0 19 16 ⨁ 45 64 71 B0 = 12 94 68 A6<br>W[6] = W[2] ⨁ W[5] =90 2E 13 80 ⨁ 12 94 68 A6 = 82 BA 7B 26<br>W[7] = W[3] ⨁ W[6] = AC C1 07 BD ⨁ 82 BA 7B 26 = 2E 7B 7C 9B</li>
</ol>
<p>所以，第一轮的密钥为 45 64 71 B0 12 94 68 A6 82 BA 7B 26 2E 7B 7C 9B。</p>
<h2 id="AES代码实现"><a href="#AES代码实现" class="headerlink" title="AES代码实现"></a>AES代码实现</h2><p><strong>Linux版本</strong><br><font size=4>aes.h</font></p>
<pre><code class="c">#ifndef AES_H
#define AES_H

/**
 * 参数 p: 明文的字符串数组。
 * 参数 plen: 明文的长度,长度必须为16的倍数。
 * 参数 key: 密钥的字符串数组。
 */
void aes(char *p, int plen, char *key);

/**
 * 参数 c: 密文的字符串数组。
 * 参数 clen: 密文的长度,长度必须为16的倍数。
 * 参数 key: 密钥的字符串数组。
 */
void deAes(char *c, int clen, char *key);

#endif</code></pre>
<p><font size=4>aes.c</font></p>
<pre><code class="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &quot;aes.h&quot;

/**
 * S盒
 */
static const int S[16][16] = { 0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76,
    0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0,
    0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15,
    0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75,
    0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84,
    0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf,
    0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8,
    0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2,
    0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73,
    0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb,
    0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79,
    0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08,
    0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a,
    0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e,
    0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf,
    0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16 };

/**
 * 逆S盒
 */
static const int S2[16][16] = { 0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb,
    0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb,
    0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e,
    0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25,
    0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92,
    0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84,
    0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06,
    0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b,
    0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73,
    0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e,
    0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b,
    0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4,
    0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f,
    0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef,
    0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61,
    0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d };

/**
 * 获取整形数据的低8位的左4个位
 */
static int getLeft4Bit(int num) {
    int left = num &amp; 0x000000f0;
    return left &gt;&gt; 4;
}

/**
 * 获取整形数据的低8位的右4个位
 */
static int getRight4Bit(int num) {
    return num &amp; 0x0000000f;
}
/**
 * 根据索引，从S盒中获得元素
 */
static int getNumFromSBox(int index) {
    int row = getLeft4Bit(index);
    int col = getRight4Bit(index);
    return S[row][col];
}

/**
 * 把一个字符转变成整型
 */
static int getIntFromChar(char c) {
    int result = (int) c;
    return result &amp; 0x000000ff;
}

/**
 * 把16个字符转变成4X4的数组，
 * 该矩阵中字节的排列顺序为从上到下，
 * 从左到右依次排列。
 */
static void convertToIntArray(char *str, int pa[4][4]) {
    int k = 0;
    for(int i = 0; i &lt; 4; i++)
        for(int j = 0; j &lt; 4; j++) {
            pa[j][i] = getIntFromChar(str[k]);
            k++;
        }
}

/**
 * 打印4X4的数组
 */
static void printArray(int a[4][4]) {
    for(int i = 0; i &lt; 4; i++){
        for(int j = 0; j &lt; 4; j++)
            printf(&quot;a[%d][%d] = 0x%x &quot;, i, j, a[i][j]);
        printf(&quot;\n&quot;);
    }
    printf(&quot;\n&quot;);
}

/**
 * 打印字符串的ASSCI，
 * 以十六进制显示。
 */
static void printASSCI(char *str, int len) {
    for(int i = 0; i &lt; len; i++)
        printf(&quot;0x%x &quot;, getIntFromChar(str[i]));
    printf(&quot;\n&quot;);
}

/**
 * 把连续的4个字符合并成一个4字节的整型
 */
static int getWordFromStr(char *str) {
    int one = getIntFromChar(str[0]);
 one = one &lt;&lt; 24;
    int two = getIntFromChar(str[1]);
    two = two &lt;&lt; 16;
    int three = getIntFromChar(str[2]);
    three = three &lt;&lt; 8;
    int four = getIntFromChar(str[3]);
    return one | two | three | four;
}

/**
 * 把一个4字节的数的第一、二、三、四个字节取出，
 * 入进一个4个元素的整型数组里面。
 */
static void splitIntToArray(int num, int array[4]) {
    int one = num &gt;&gt; 24;
    array[0] = one &amp; 0x000000ff;
    int two = num &gt;&gt; 16;
    array[1] = two &amp; 0x000000ff;
    int three = num &gt;&gt; 8;
    array[2] = three &amp; 0x000000ff;
    array[3] = num &amp; 0x000000ff;
}

/**
 * 将数组中的元素循环左移step位
 */
static void leftLoop4int(int array[4], int step) {
    int temp[4];
    for(int i = 0; i &lt; 4; i++)
        temp[i] = array[i];

    int index = step % 4 == 0 ? 0 : step % 4;
    for(int i = 0; i &lt; 4; i++){
        array[i] = temp[index];
        index++;
        index = index % 4;
    }
}

/**
 * 把数组中的第一、二、三和四元素分别作为
 * 4字节整型的第一、二、三和四字节，合并成一个4字节整型
 */
static int mergeArrayToInt(int array[4]) {
    int one = array[0] &lt;&lt; 24;
    int two = array[1] &lt;&lt; 16;
    int three = array[2] &lt;&lt; 8;
    int four = array[3];
    return one | two | three | four;
}

/**
 * 常量轮值表
 */
static const int Rcon[10] = { 0x01000000, 0x02000000,
    0x04000000, 0x08000000,
    0x10000000, 0x20000000,
    0x40000000, 0x80000000,
    0x1b000000, 0x36000000 };
/**
 * 密钥扩展中的T函数
 */
static int T(int num, int round) {
    int numArray[4];
    splitIntToArray(num, numArray);
    leftLoop4int(numArray, 1);//字循环

    //字节代换
    for(int i = 0; i &lt; 4; i++)
        numArray[i] = getNumFromSBox(numArray[i]);

    int result = mergeArrayToInt(numArray);
    return result ^ Rcon[round];
}

//密钥对应的扩展数组
static int w[44];

/**
 * 扩展密钥，结果是把w[44]中的每个元素初始化
 */
static void extendKey(char *key) {
    for(int i = 0; i &lt; 4; i++)
        w[i] = getWordFromStr(key + i * 4);

    for(int i = 4, j = 0; i &lt; 44; i++) {
        if( i % 4 == 0) {
            w[i] = w[i - 4] ^ T(w[i - 1], j);
            j++;//下一轮
        }else {
            w[i] = w[i - 4] ^ w[i - 1];
        }
    }

}

/**
 * 轮密钥加
 */
static void addRoundKey(int array[4][4], int round) {
    int warray[4];
    for(int i = 0; i &lt; 4; i++) {

        splitIntToArray(w[ round * 4 + i], warray);

        for(int j = 0; j &lt; 4; j++) {
            array[j][i] = array[j][i] ^ warray[j];
        }
    }
}

/**
 * 字节代换
 */
static void subBytes(int array[4][4]){
    for(int i = 0; i &lt; 4; i++)
        for(int j = 0; j &lt; 4; j++)
            array[i][j] = getNumFromSBox(array[i][j]);
}

/**
 * 行移位
 */
static void shiftRows(int array[4][4]) {
    int rowTwo[4], rowThree[4], rowFour[4];
    //复制状态矩阵的第2,3,4行
    for(int i = 0; i &lt; 4; i++) {
        rowTwo[i] = array[1][i];
        rowThree[i] = array[2][i];
        rowFour[i] = array[3][i];
    }
    //循环左移相应的位数
    leftLoop4int(rowTwo, 1);
    leftLoop4int(rowThree, 2);
    leftLoop4int(rowFour, 3);

    //把左移后的行复制回状态矩阵中
    for(int i = 0; i &lt; 4; i++) {
        array[1][i] = rowTwo[i];
        array[2][i] = rowThree[i];
        array[3][i] = rowFour[i];
    }
}

/**
 * 列混合要用到的矩阵
 */
static const int colM[4][4] = { 2, 3, 1, 1,
    1, 2, 3, 1,
    1, 1, 2, 3,
    3, 1, 1, 2 };

static int GFMul2(int s) {
    int result = s &lt;&lt; 1;
    int a7 = result &amp; 0x00000100;

    if(a7 != 0) {
        result = result &amp; 0x000000ff;
        result = result ^ 0x1b;
    }

    return result;
}

static int GFMul3(int s) {
    return GFMul2(s) ^ s;
}

static int GFMul4(int s) {
    return GFMul2(GFMul2(s));
}

static int GFMul8(int s) {
    return GFMul2(GFMul4(s));
}

static int GFMul9(int s) {
    return GFMul8(s) ^ s;
}

static int GFMul11(int s) {
    return GFMul9(s) ^ GFMul2(s);
}

static int GFMul12(int s) {
    return GFMul8(s) ^ GFMul4(s);
}

static int GFMul13(int s) {
    return GFMul12(s) ^ s;
}

static int GFMul14(int s) {
    return GFMul12(s) ^ GFMul2(s);
}

/**
 * GF上的二元运算
 */
static int GFMul(int n, int s) {
    int result;

    if(n == 1)
        result = s;
    else if(n == 2)
        result = GFMul2(s);
    else if(n == 3)
        result = GFMul3(s);
    else if(n == 0x9)
        result = GFMul9(s);
    else if(n == 0xb)//11
        result = GFMul11(s);
    else if(n == 0xd)//13
        result = GFMul13(s);
    else if(n == 0xe)//14
        result = GFMul14(s);

    return result;
}
/**
 * 列混合
 */
static void mixColumns(int array[4][4]) {

    int tempArray[4][4];

    for(int i = 0; i &lt; 4; i++)
        for(int j = 0; j &lt; 4; j++)
            tempArray[i][j] = array[i][j];

    for(int i = 0; i &lt; 4; i++)
        for(int j = 0; j &lt; 4; j++){
            array[i][j] = GFMul(colM[i][0],tempArray[0][j]) ^ GFMul(colM[i][1],tempArray[1][j]) 
                ^ GFMul(colM[i][2],tempArray[2][j]) ^ GFMul(colM[i][3], tempArray[3][j]);
        }
}
/**
 * 把4X4数组转回字符串
 */
static void convertArrayToStr(int array[4][4], char *str) {
    for(int i = 0; i &lt; 4; i++)
        for(int j = 0; j &lt; 4; j++)
            *str++ = (char)array[j][i];    
}
/**
 * 检查密钥长度
 */
static int checkKeyLen(int len) {
    if(len == 16)
        return 1;
    else
        return 0;
}

/**
 * 参数 p: 明文的字符串数组。
 * 参数 plen: 明文的长度。
 * 参数 key: 密钥的字符串数组。
 */
void aes(char *p, int plen, char *key){

    int keylen = strlen(key);
    if(plen == 0 || plen % 16 != 0) {
        printf(&quot;明文字符长度必须为16的倍数！\n&quot;);
        exit(0);
    }

    if(!checkKeyLen(keylen)) {
        printf(&quot;密钥字符长度错误！长度必须为16、24和32。当前长度为%d\n&quot;,keylen);
        exit(0);
    }

    extendKey(key);//扩展密钥
    int pArray[4][4];

    for(int k = 0; k &lt; plen; k += 16) {    
        convertToIntArray(p + k, pArray);

        addRoundKey(pArray, 0);//一开始的轮密钥加

        for(int i = 1; i &lt; 10; i++){//前9轮

            subBytes(pArray);//字节代换

            shiftRows(pArray);//行移位

            mixColumns(pArray);//列混合

            addRoundKey(pArray, i);

        }

        //第10轮
        subBytes(pArray);//字节代换

        shiftRows(pArray);//行移位

        addRoundKey(pArray, 10);

        convertArrayToStr(pArray, p + k);
    }
}
/**
 * 根据索引从逆S盒中获取值
 */
static int getNumFromS1Box(int index) {
    int row = getLeft4Bit(index);
    int col = getRight4Bit(index);
    return S2[row][col];
}
/**
 * 逆字节变换
 */
static void deSubBytes(int array[4][4]) {
    for(int i = 0; i &lt; 4; i++)
        for(int j = 0; j &lt; 4; j++)
            array[i][j] = getNumFromS1Box(array[i][j]);
}
/**
 * 把4个元素的数组循环右移step位
 */
static void rightLoop4int(int array[4], int step) {
    int temp[4];
    for(int i = 0; i &lt; 4; i++)
        temp[i] = array[i];

    int index = step % 4 == 0 ? 0 : step % 4;
    index = 3 - index;
    for(int i = 3; i &gt;= 0; i--) {
        array[i] = temp[index];
        index--;
        index = index == -1 ? 3 : index;
    }
}

/**
 * 逆行移位
 */
static void deShiftRows(int array[4][4]) {
    int rowTwo[4], rowThree[4], rowFour[4];
    for(int i = 0; i &lt; 4; i++) {
        rowTwo[i] = array[1][i];
        rowThree[i] = array[2][i];
        rowFour[i] = array[3][i];
    }

    rightLoop4int(rowTwo, 1);
    rightLoop4int(rowThree, 2);
    rightLoop4int(rowFour, 3);

    for(int i = 0; i &lt; 4; i++) {
        array[1][i] = rowTwo[i];
        array[2][i] = rowThree[i];
        array[3][i] = rowFour[i];
    }
}
/**
 * 逆列混合用到的矩阵
 */
static const int deColM[4][4] = { 0xe, 0xb, 0xd, 0x9,
    0x9, 0xe, 0xb, 0xd,
    0xd, 0x9, 0xe, 0xb,
    0xb, 0xd, 0x9, 0xe };

/**
 * 逆列混合
 */
static void deMixColumns(int array[4][4]) {
    int tempArray[4][4];

    for(int i = 0; i &lt; 4; i++)
        for(int j = 0; j &lt; 4; j++)
            tempArray[i][j] = array[i][j];

    for(int i = 0; i &lt; 4; i++)
        for(int j = 0; j &lt; 4; j++){
            array[i][j] = GFMul(deColM[i][0],tempArray[0][j]) ^ GFMul(deColM[i][1],tempArray[1][j]) 
                ^ GFMul(deColM[i][2],tempArray[2][j]) ^ GFMul(deColM[i][3], tempArray[3][j]);
        }
}
/**
 * 把两个4X4数组进行异或
 */
static void addRoundTowArray(int aArray[4][4],int bArray[4][4]) {
    for(int i = 0; i &lt; 4; i++)
        for(int j = 0; j &lt; 4; j++)
            aArray[i][j] = aArray[i][j] ^ bArray[i][j];
}
/**
 * 从4个32位的密钥字中获得4X4数组，
 * 用于进行逆列混合
 */
static void getArrayFrom4W(int i, int array[4][4]) {
    int index = i * 4;
    int colOne[4], colTwo[4], colThree[4], colFour[4];
    splitIntToArray(w[index], colOne);
    splitIntToArray(w[index + 1], colTwo);
    splitIntToArray(w[index + 2], colThree);
    splitIntToArray(w[index + 3], colFour);

    for(int i = 0; i &lt; 4; i++) {
        array[i][0] = colOne[i];
        array[i][1] = colTwo[i];
        array[i][2] = colThree[i];
        array[i][3] = colFour[i];
    }

}

/**
 * 参数 c: 密文的字符串数组。
 * 参数 clen: 密文的长度。
 * 参数 key: 密钥的字符串数组。
 */
void deAes(char *c, int clen, char *key) {

    int keylen = strlen(key);
    if(clen == 0 || clen % 16 != 0) {
        printf(&quot;密文字符长度必须为16的倍数！现在的长度为%d\n&quot;,clen);
        exit(0);
    }

    if(!checkKeyLen(keylen)) {
        printf(&quot;密钥字符长度错误！长度必须为16、24和32。当前长度为%d\n&quot;,keylen);
        exit(0);
    }

    extendKey(key);//扩展密钥
    int cArray[4][4];
    for(int k = 0; k &lt; clen; k += 16) {
        convertToIntArray(c + k, cArray);


        addRoundKey(cArray, 10);

        int wArray[4][4];
        for(int i = 9; i &gt;= 1; i--) {
            deSubBytes(cArray);

            deShiftRows(cArray);

            deMixColumns(cArray);
            getArrayFrom4W(i, wArray);
            deMixColumns(wArray);

            addRoundTowArray(cArray, wArray);
        }

        deSubBytes(cArray);

        deShiftRows(cArray);

        addRoundKey(cArray, 0);

        convertArrayToStr(cArray, c + k);

 }
}</code></pre>
<p><font size=4>main.c</font></p>
<pre><code class="c">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;

#include &quot;aes.h&quot;

#define MAXLEN 1024

void getString(char *str, int len){

    int slen = read(0, str, len);
    for(int i = 0; i &lt; slen; i++,str++){
        if(*str == &#39;\n&#39;){
            *str = &#39;\0&#39;;
            break;
        }
    }
}

void printASCCI(char *str, int len) {
    int c;
    for(int i = 0; i &lt; len; i++) {
        c = (int)*str++;
        c = c &amp; 0x000000ff;
        printf(&quot;0x%x &quot;, c);
    }
    printf(&quot;\n&quot;);
}

/**
 * 从标准输入中读取用户输入的字符串
 */
void readPlainText(char *str, int *len) {
    int plen;
    while(1) {
        getString(str, MAXLEN);
        plen = strlen(str);
        if(plen != 0 &amp;&amp; plen % 16 == 0) {
            printf(&quot;你输入的明文为：%s\n&quot;, str);
            break;
        }else{
            printf(&quot;明文字符长度必须为16的倍数,现在的长度为%d\n&quot;, plen);
        }
    }
    *len = plen;
}
/**
 * 把字符串写进文件
 */
void writeStrToFile(char *str, int len, char *fileName) {
    FILE *fp;
    fp = fopen(fileName, &quot;wb&quot;);
    for(int i = 0; i &lt; len; i++)
        putc(str[i], fp);
    fclose(fp);
}


void aesStrToFile(char *key) {

    char p[MAXLEN];
    int plen;
    printf(&quot;请输入你的明文，明文字符长度必须为16的倍数\n&quot;);
    readPlainText(p,&amp;plen);
    printf(&quot;进行AES加密..................\n&quot;);

    aes(p, plen, key);//AES加密

    printf(&quot;加密完后的明文的ASCCI为：\n&quot;);
    printASCCI(p, plen);
    char fileName[64];
    printf(&quot;请输入你想要写进的文件名，比如&#39;test.txt&#39;:\n&quot;);
    if(scanf(&quot;%s&quot;, fileName) == 1) {    
        writeStrToFile(p, plen, fileName);
        printf(&quot;已经将密文写进%s中了,可以在运行该程序的当前目录中找到它。\n&quot;, fileName);
    }
}
/**
 * 从文件中读取字符串
 */
int readStrFromFile(char *fileName, char *str) {
    FILE *fp = fopen(fileName, &quot;rb&quot;);
    if(fp == NULL) {
        printf(&quot;打开文件出错，请确认文件存在当前目录下！\n&quot;);
        exit(0);
    }

    int i;
    for(i = 0; i &lt; MAXLEN &amp;&amp; (str[i] = getc(fp)) != EOF; i++);

    if(i &gt;= MAXLEN) {
        printf(&quot;解密文件过大！\n&quot;);
        exit(0);
    }

    str[i] = &#39;\0&#39;;
    fclose(fp);
    return i;
}


void deAesFile(char *key) {
    char fileName[64];
    char c[MAXLEN];//密文字符串
    printf(&quot;请输入要解密的文件名，该文件必须和本程序在同一个目录\n&quot;);
    if(scanf(&quot;%s&quot;, fileName) == 1) {
        int clen = readStrFromFile(fileName, c);
        printf(&quot;开始解密.........\n&quot;);
        deAes(c, clen, key);
        printf(&quot;解密后的明文ASCII为：\n&quot;);
        printASCCI(c, clen);
        printf(&quot;明文为：%s\n&quot;, c);
        writeStrToFile(c,clen,fileName);
        printf(&quot;现在可以打开%s来查看解密后的密文了！\n&quot;,fileName);
    }
}

void aesFile(char *key) {
    char fileName[64];
    char fileP[MAXLEN];

    printf(&quot;请输入要加密的文件名，该文件必须和本程序在同一个目录\n&quot;);
    if(scanf(&quot;%s&quot;, fileName) == 1) {
        readStrFromFile(fileName, fileP);
        int plen = strlen(fileP);
        printf(&quot;开始加密.........\n&quot;);
        printf(&quot;加密前文件中字符的ASCII为：\n&quot;);
        printASCCI(fileP, plen);

        aes(fileP, plen, key);//开始加密

        printf(&quot;加密后的密文ASCII为：\n&quot;);
        printASCCI(fileP, plen);
        writeStrToFile(fileP,plen,fileName);
        printf(&quot;已经将加密后的密文写进%s中了\n&quot;,fileName);
    }
}

int main(int argc, char const *argv[]) {

    char key[17];
    printf(&quot;请输入16个字符的密钥：\n&quot;);
    int klen;
    while(1){
        getString(key,17);
        klen = strlen(key);
        if(klen != 16){
            printf(&quot;请输入16个字符的密钥,当前密钥的长度为%d\n&quot;,klen);
        }else{
            printf(&quot;你输入的密钥为：%s\n&quot;,key);
            break;
        }
    }

    printf(&quot;输入&#39;s&#39;表示要加密输入的字符串,并将加密后的内容写入到文件\n&quot;);
    printf(&quot;请输入要功能选项并按回车，输入&#39;f&#39;表示要加密文件\n&quot;);
    printf(&quot;输入&#39;p&#39;表示要解密文件\n&quot;);
    char c;
    if(scanf(&quot;%s&quot;,&amp;c) == 1) {
        if(c == &#39;s&#39;)
            aesStrToFile(key);//用AES加密字符串，并将字符串写进文件中
        else if(c == &#39;p&#39;)
            deAesFile(key);//把文件中的密文解密，并写回文件中
        else if(c == &#39;f&#39;)//用AES加密文件
            aesFile(key);
    }
    return 0;
}</code></pre>
<p><font size=4>通过下面的gcc命令来编译运行：</font></p>
<blockquote>
<p>gcc -o aes aes.c main.c</p>
</blockquote>
<h2 id="分组密码加密中的四种模式"><a href="#分组密码加密中的四种模式" class="headerlink" title="分组密码加密中的四种模式:"></a>分组密码加密中的四种模式:</h2><h3 id="ECB模式"><a href="#ECB模式" class="headerlink" title="ECB模式"></a>ECB模式</h3><p><img src="aes23.jpg" alt="aes23"><br>优点:</p>
<ol>
<li>简单；</li>
<li>有利于并行计算；</li>
<li>误差不会被传送；</li>
</ol>
<p>缺点:</p>
<ol>
<li>不能隐藏明文的模式；</li>
<li>可能对明文进行主动攻击；</li>
</ol>
<p><img src="aes24.jpg" alt="aes24"></p>
<h3 id="CBC模式"><a href="#CBC模式" class="headerlink" title="CBC模式"></a>CBC模式</h3><p><img src="aes25.jpg" alt="aes25"><br>优点：<br>1.不容易主动攻击,安全性好于ECB,适合传输长度长的报文,是SSL、IPSec的标准。</p>
<p>缺点：</p>
<ol>
<li>不利于并行计算；</li>
<li>误差传递；</li>
<li>需要初始化向量IV</li>
</ol>
<h3 id="CFB模式"><a href="#CFB模式" class="headerlink" title="CFB模式"></a>CFB模式</h3><p><img src="aes26.jpg" alt="aes26"><br>优点：</p>
<ol>
<li>隐藏了明文模式;</li>
<li>分组密码转化为流模式;</li>
<li>可以及时加密传送小于分组的数据;</li>
</ol>
<p>缺点:</p>
<ol>
<li>不利于并行计算;</li>
<li>误差传送：一个明文单元损坏影响多个单元;</li>
<li>唯一的IV;</li>
</ol>
<h3 id="OFB模式"><a href="#OFB模式" class="headerlink" title="OFB模式"></a>OFB模式</h3><p><img src="aes27.jpg" alt="aes27"><br>优点:</p>
<p>1.隐藏了明文模式;<br>2.分组密码转化为流模式;<br>3.可以及时加密传送小于分组的数据;</p>
<p>缺点:</p>
<ol>
<li>不利于并行计算;</li>
<li>对明文的主动攻击是可能的;</li>
<li>误差传送：一个明文单元损坏影响多个单元;</li>
</ol>
<p>原文链接:<a href="https://blog.csdn.net/qq_28205153/article/details/55798628" target="_blank" rel="noopener">https://blog.csdn.net/qq_28205153/article/details/55798628</a></p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 zjre@qq.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>Aes加密解析</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">7k</span></p>
    <p><span class="copy-title">本文作者:</span><a  title="ZJR">ZJR</a></p>
    <p><span class="copy-title">发布时间:</span>2020-02-18, 11:13:30</p>
    <p><span class="copy-title">最后更新:</span>2020-02-28, 20:51:08</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2020/02/18/Aes/" title="Aes加密解析">http://zjr-g.github.io/2020/02/18/Aes/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2019-2020 Zlog</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#aes加密','#base64','#ctf-web','#file_incloude','#Git','#MySql_show','#MySql_where','#MySql_like','#MySql_select','#MySql_order by','#MySql_regexp','#MySql_concat','#MySql_function','#MySql_group by','#MySql_having','#MySql_subquery','#MySql_jion','#MySql_union','#MySql_insert','#MySql_update','#MySql_delete','#MySql_create','#MySql_alter','#SSIT','#zip','#Markdown','#hexo',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
